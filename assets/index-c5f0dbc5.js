import{z as B,R as Fe,E as P,a3 as ce,A as $,K as A,a4 as q,ao as j,g as O,T as Ne,ac as _e,V as W,aI as Le,J as Se,d as c,a2 as ke,al as me,U as we,a9 as de,M as N,Q as ie,L as Ue,C as T,D as je,H as L,aJ as ee,aw as Te,a1 as De,aa as Q,aK as ze,P as X,ap as Ke,ad as te,a5 as Ye,F as Oe,aL as qe,e as xe,aM as Ge,af as ae,ag as ne,az as Je,an as G,_ as Qe,aH as We,u as Xe,ai as Ze,f as et,h as tt,o as at,c as nt}from"./index-ed287d35.js";import{C as pe}from"./index-c79f315e.js";import{F as J}from"./index-502fadcb.js";import{a as lt,T as ot}from"./index-7bb4b073.js";import{_ as Ve}from"./Header-0bffad9e.js";import{F as st}from"./index-250eb5c5.js";import{B as fe}from"./index-653ff191.js";import"./use-route-f75f7c81.js";import"./use-id-bf90b298.js";const[ct,E,ve]=B("picker"),Ee=e=>e.find(a=>!a.disabled)||e[0];function it(e,a){const t=e[0];if(t){if(Array.isArray(t))return"multiple";if(a.children in t)return"cascade"}return"default"}function re(e,a){a=ce(a,0,e.length);for(let t=a;t<e.length;t++)if(!e[t].disabled)return t;for(let t=a-1;t>=0;t--)if(!e[t].disabled)return t;return 0}const he=(e,a,t)=>a!==void 0&&!!e.find(s=>s[t.value]===a);function ue(e,a,t){const s=e.findIndex(v=>v[t.value]===a),n=re(e,s);return e[n]}function rt(e,a,t){const s=[];let n={[a.children]:e},v=0;for(;n&&n[a.children];){const i=n[a.children],f=t.value[v];if(n=Fe(f)?ue(i,f,a):void 0,!n&&i.length){const r=Ee(i)[a.value];n=ue(i,r,a)}v++,s.push(i)}return s}function ut(e){const{transform:a}=window.getComputedStyle(e),t=a.slice(7,a.length-1).split(", ")[5];return Number(t)}function dt(e){return P({text:"text",value:"value",children:"children"},e)}const ge=200,be=300,mt=15,[Pe,le]=B("picker-column"),Be=Symbol(Pe);var ft=$({name:Pe,props:{value:A,fields:q(Object),options:j(),readonly:Boolean,allowHtml:Boolean,optionHeight:q(Number),swipeDuration:q(A),visibleOptionNum:q(A)},emits:["change","clickOption"],setup(e,{emit:a,slots:t}){let s,n,v,i,f;const r=O(),l=O(),d=O(0),b=O(0),y=Ne(),k=()=>e.options.length,V=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,D=h=>{const C=re(e.options,h),o=-C*e.optionHeight,u=()=>{const S=e.options[C][e.fields.value];S!==e.value&&a("change",S)};s&&o!==d.value?f=u:u(),d.value=o},x=()=>e.readonly||!e.options.length,z=h=>{s||x()||(f=null,b.value=ge,D(h),a("clickOption",e.options[h]))},M=h=>ce(Math.round(-h/e.optionHeight),0,k()-1),I=(h,C)=>{const o=Math.abs(h/C);h=d.value+o/.003*(h<0?-1:1);const u=M(h);b.value=+e.swipeDuration,D(u)},H=()=>{s=!1,b.value=0,f&&(f(),f=null)},m=h=>{if(!x()){if(y.start(h),s){const C=ut(l.value);d.value=Math.min(0,C-V())}b.value=0,n=d.value,v=Date.now(),i=n,f=null}},_=h=>{if(x())return;y.move(h),y.isVertical()&&(s=!0,ke(h,!0)),d.value=ce(n+y.deltaY.value,-(k()*e.optionHeight),e.optionHeight);const C=Date.now();C-v>be&&(v=C,i=d.value)},g=()=>{if(x())return;const h=d.value-i,C=Date.now()-v;if(C<be&&Math.abs(h)>mt){I(h,C);return}const u=M(d.value);b.value=ge,D(u),setTimeout(()=>{s=!1},0)},p=()=>{const h={height:`${e.optionHeight}px`};return e.options.map((C,o)=>{const u=C[e.fields.text],{disabled:S}=C,Y=C[e.fields.value],K={role:"button",style:h,tabindex:S?-1:0,class:[le("item",{disabled:S,selected:Y===e.value}),C.className],onClick:()=>z(o)},He={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:u};return c("li",K,[t.option?t.option(C):c("div",He,null)])})};return _e(Be),W({stopMomentum:H}),Le(()=>{const h=e.options.findIndex(u=>u[e.fields.value]===e.value),o=-re(e.options,h)*e.optionHeight;d.value=o}),Se("touchmove",_,{target:r}),()=>c("div",{ref:r,class:le(),onTouchstartPassive:m,onTouchend:g,onTouchcancel:g},[c("ul",{ref:l,style:{transform:`translate3d(0, ${d.value+V()}px, 0)`,transitionDuration:`${b.value}ms`,transitionProperty:b.value?"all":"none"},class:le("wrapper"),onTransitionend:H},[p()])])}});const[vt]=B("picker-toolbar"),Z={title:String,cancelButtonText:String,confirmButtonText:String},ht=["cancel","confirm","title","toolbar"],gt=Object.keys(Z);var Re=$({name:vt,props:Z,emits:["confirm","cancel"],setup(e,{emit:a,slots:t}){const s=()=>{if(t.title)return t.title();if(e.title)return c("div",{class:[E("title"),"van-ellipsis"]},[e.title])},n=()=>a("cancel"),v=()=>a("confirm"),i=()=>{const r=e.cancelButtonText||ve("cancel");return c("button",{type:"button",class:[E("cancel"),me],onClick:n},[t.cancel?t.cancel():r])},f=()=>{const r=e.confirmButtonText||ve("confirm");return c("button",{type:"button",class:[E("confirm"),me],onClick:v},[t.confirm?t.confirm():r])};return()=>c("div",{class:E("toolbar")},[t.toolbar?t.toolbar():[i(),s(),f()]])}});const[$e,oe]=B("picker-group"),Ae=Symbol($e),bt=P({tabs:j()},Z);$({name:$e,props:bt,emits:["confirm","cancel"],setup(e,{emit:a,slots:t}){const{children:s,linkChildren:n}=we(Ae);n();const v=()=>{a("confirm",s.map(f=>f.confirm()))},i=()=>a("cancel");return()=>{var f;const r=(f=t.default)==null?void 0:f.call(t);return c("div",{class:oe()},[c(Re,de(e,{onConfirm:v,onCancel:i}),null),c(lt,{shrink:!0,class:oe("tabs"),animated:!0},{default:()=>[e.tabs.map((l,d)=>c(ot,{title:l,titleClass:oe("tab-title")},{default:()=>[r==null?void 0:r[d]]}))]})])}}});const Me=P({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:N(44),showToolbar:ie,swipeDuration:N(1e3),visibleOptionNum:N(6)},Z),yt=P({},Me,{columns:j(),modelValue:j(),toolbarPosition:Ue("top"),columnsFieldNames:Object});var Ct=$({name:ct,props:yt,emits:["confirm","cancel","change","clickOption","update:modelValue"],setup(e,{emit:a,slots:t}){const s=O(),n=O(e.modelValue.slice(0)),{parent:v}=_e(Ae),{children:i,linkChildren:f}=we(Be);f();const r=T(()=>dt(e.columnsFieldNames)),l=T(()=>je(e.optionHeight)),d=T(()=>it(e.columns,r.value)),b=T(()=>{const{columns:o}=e;switch(d.value){case"multiple":return o;case"cascade":return rt(o,r.value,n);default:return[o]}}),y=T(()=>b.value.some(o=>o.length)),k=T(()=>b.value.map((o,u)=>ue(o,n.value[u],r.value))),V=T(()=>b.value.map((o,u)=>o.findIndex(S=>S[r.value.value]===n.value[u]))),D=(o,u)=>{if(n.value[o]!==u){const S=n.value.slice(0);S[o]=u,n.value=S}},x=()=>({selectedValues:n.value.slice(0),selectedOptions:k.value,selectedIndexes:V.value}),z=(o,u)=>{D(u,o),d.value==="cascade"&&n.value.forEach((S,Y)=>{const K=b.value[Y];he(K,S,r.value)||D(Y,K.length?K[0][r.value.value]:void 0)}),a("change",P({columnIndex:u},x()))},M=(o,u)=>a("clickOption",P({columnIndex:u,currentOption:o},x())),I=()=>{i.forEach(u=>u.stopMomentum());const o=x();return De(()=>{a("confirm",o)}),o},H=()=>a("cancel",x()),m=()=>b.value.map((o,u)=>c(ft,{value:n.value[u],fields:r.value,options:o,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:l.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:S=>z(S,u),onClickOption:S=>M(S,u)},{option:t.option})),_=o=>{if(y.value){const u={height:`${l.value}px`},S={backgroundSize:`100% ${(o-l.value)/2}px`};return[c("div",{class:E("mask"),style:S},null),c("div",{class:[ze,E("frame")],style:u},null)]}},g=()=>{const o=l.value*+e.visibleOptionNum,u={height:`${o}px`};return c("div",{ref:s,class:E("columns"),style:u},[m(),_(o)])},p=()=>{if(e.showToolbar&&!v)return c(Re,de(Q(e,gt),{onConfirm:I,onCancel:H}),Q(t,ht))};L(b,o=>{o.forEach((u,S)=>{u.length&&!he(u,n.value[S],r.value)&&D(S,Ee(u)[r.value.value])})},{immediate:!0});let h;return L(()=>e.modelValue,o=>{!ee(o,n.value)&&!ee(o,h)&&(n.value=o.slice(0))},{deep:!0}),L(n,o=>{ee(o,e.modelValue)||(h=o.slice(0),a("update:modelValue",h))},{immediate:!0}),Se("touchmove",ke,{target:s}),W({confirm:I,getSelectedOptions:()=>k.value}),()=>{var o,u;return c("div",{class:E()},[e.toolbarPosition==="top"?p():null,e.loading?c(Te,{class:E("loading")},null):null,(o=t["columns-top"])==null?void 0:o.call(t),g(),(u=t["columns-bottom"])==null?void 0:u.call(t),e.toolbarPosition==="bottom"?p():null])}}});const U="000000",_t=["title","cancel","confirm","toolbar","columns-top","columns-bottom"],St=["title","loading","readonly","optionHeight","swipeDuration","visibleOptionNum","cancelButtonText","confirmButtonText"],R=(e="",a=U,t=void 0)=>({text:e,value:a,children:t});function kt({areaList:e,columnsNum:a,columnsPlaceholder:t}){const{city_list:s={},county_list:n={},province_list:v={}}=e,i=a>1,f=a>2,r=()=>{if(i)return t.length?[R(t[0],U,f?[]:void 0)]:[]},l=new Map;Object.keys(v).forEach(y=>{l.set(y.slice(0,2),R(v[y],y,r()))});const d=new Map;if(i){const y=()=>{if(f)return t.length?[R(t[1])]:[]};Object.keys(s).forEach(k=>{const V=R(s[k],k,y());d.set(k.slice(0,4),V);const D=l.get(k.slice(0,2));D&&D.children.push(V)})}f&&Object.keys(n).forEach(y=>{const k=d.get(y.slice(0,4));k&&k.children.push(R(n[y],y))});const b=Array.from(l.values());if(t.length){const y=f?[R(t[2])]:void 0,k=i?[R(t[1],U,y)]:void 0;b.unshift(R(t[0],U,k))}return b}const wt=X(Ct),[Tt,Dt]=B("area"),Ot=P({},Me,{modelValue:String,columnsNum:N(3),columnsPlaceholder:j(),areaList:{type:Object,default:()=>({})}});var xt=$({name:Tt,props:Ot,emits:["change","confirm","cancel","update:modelValue"],setup(e,{emit:a,slots:t}){const s=O([]),n=O(),v=T(()=>kt(e)),i=(...l)=>a("change",...l),f=(...l)=>a("cancel",...l),r=(...l)=>a("confirm",...l);return L(s,l=>{const d=l.length?l[l.length-1]:"";d&&d!==e.modelValue&&a("update:modelValue",d)},{deep:!0}),L(()=>e.modelValue,l=>{if(l){const d=s.value.length?s.value[s.value.length-1]:"";l!==d&&(s.value=[`${l.slice(0,2)}0000`,`${l.slice(0,4)}00`,l].slice(0,+e.columnsNum))}else s.value=[]},{immediate:!0}),W({confirm:()=>{var l;return(l=n.value)==null?void 0:l.confirm()},getSelectedOptions:()=>{var l;return((l=n.value)==null?void 0:l.getSelectedOptions())||[]}}),()=>c(wt,de({ref:n,modelValue:s.value,"onUpdate:modelValue":l=>s.value=l,class:Dt(),columns:v.value,onChange:i,onCancel:f,onConfirm:r},Q(e,St)),Q(t,_t))}});const pt=X(xt),[Vt,se]=B("switch"),Et={size:A,loading:Boolean,disabled:Boolean,modelValue:te,activeColor:String,inactiveColor:String,activeValue:{type:te,default:!0},inactiveValue:{type:te,default:!1}};var Pt=$({name:Vt,props:Et,emits:["change","update:modelValue"],setup(e,{emit:a,slots:t}){const s=()=>e.modelValue===e.activeValue,n=()=>{if(!e.disabled&&!e.loading){const i=s()?e.inactiveValue:e.activeValue;a("update:modelValue",i),a("change",i)}},v=()=>{if(e.loading){const i=s()?e.activeColor:e.inactiveColor;return c(Te,{class:se("loading"),color:i},null)}if(t.node)return t.node()};return Ke(()=>e.modelValue),()=>{var i;const{size:f,loading:r,disabled:l,activeColor:d,inactiveColor:b}=e,y=s(),k={fontSize:Ye(f),backgroundColor:y?d:b};return c("div",{role:"switch",class:se({on:y,loading:r,disabled:l}),style:k,tabindex:l?void 0:0,"aria-checked":y,onClick:n},[c("div",{class:se("node")},[v()]),(i=t.background)==null?void 0:i.call(t)])}}});const Bt=X(Pt),[Rt,ye]=B("address-edit-detail"),Ce=B("address-edit")[2];var $t=$({name:Rt,props:{show:Boolean,rows:A,value:String,rules:Array,focused:Boolean,maxlength:A,searchResult:Array,showSearchResult:Boolean},emits:["blur","focus","input","selectSearch"],setup(e,{emit:a}){const t=O(),s=()=>e.focused&&e.searchResult&&e.showSearchResult,n=l=>{a("selectSearch",l),a("input",`${l.address||""} ${l.name||""}`.trim())},v=()=>{if(!s())return;const{searchResult:l}=e;return l.map(d=>c(pe,{clickable:!0,key:(d.name||"")+(d.address||""),icon:"location-o",title:d.name,label:d.address,class:ye("search-item"),border:!1,onClick:()=>n(d)},null))},i=l=>a("blur",l),f=l=>a("focus",l),r=l=>a("input",l);return()=>{if(e.show)return c(Oe,null,[c(J,{autosize:!0,clearable:!0,ref:t,class:ye(),rows:e.rows,type:"textarea",rules:e.rules,label:Ce("addressDetail"),border:!s(),maxlength:e.maxlength,modelValue:e.value,placeholder:Ce("addressDetail"),onBlur:i,onFocus:f,"onUpdate:modelValue":r},null),v()])}}});const[At,F,w]=B("address-edit"),Ie={name:"",tel:"",city:"",county:"",country:"",province:"",areaCode:"",isDefault:!1,addressDetail:""},Mt={areaList:Object,isSaving:Boolean,isDeleting:Boolean,validator:Function,showArea:ie,showDetail:ie,showDelete:Boolean,disableArea:Boolean,searchResult:Array,telMaxlength:A,showSetDefault:Boolean,saveButtonText:String,areaPlaceholder:String,deleteButtonText:String,showSearchResult:Boolean,detailRows:N(1),detailMaxlength:N(200),areaColumnsPlaceholder:j(),addressInfo:{type:Object,default:()=>P({},Ie)},telValidator:{type:Function,default:qe}};var It=$({name:At,props:Mt,emits:["save","focus","delete","clickArea","changeArea","changeDetail","selectSearch","changeDefault"],setup(e,{emit:a,slots:t}){const s=O(),n=xe({}),v=O(!1),i=O(!1),f=T(()=>Ge(e.areaList)&&Object.keys(e.areaList).length),r=T(()=>{const{province:m,city:_,county:g,areaCode:p}=n;if(p){const h=[m,_,g];return m&&m===_&&h.splice(1,1),h.filter(Boolean).join("/")}return""}),l=T(()=>{var m;return((m=e.searchResult)==null?void 0:m.length)&&i.value}),d=m=>{i.value=m==="addressDetail",a("focus",m)},b=T(()=>{const{validator:m,telValidator:_}=e,g=(p,h)=>({validator:C=>{if(m){const o=m(p,C);if(o)return o}return C?!0:h}});return{name:[g("name",w("nameEmpty"))],tel:[g("tel",w("telInvalid")),{validator:_,message:w("telInvalid")}],areaCode:[g("areaCode",w("areaEmpty"))],addressDetail:[g("addressDetail",w("addressEmpty"))]}}),y=()=>a("save",n),k=m=>{n.addressDetail=m,a("changeDetail",m)},V=m=>{n.province=m[0].text,n.city=m[1].text,n.county=m[2].text},D=({selectedValues:m,selectedOptions:_})=>{m.some(g=>g===U)?G(w("areaEmpty")):(v.value=!1,V(_),a("changeArea",_))},x=()=>a("delete",n),z=m=>{n.areaCode=m||""},M=()=>{setTimeout(()=>{i.value=!1})},I=m=>{n.addressDetail=m},H=()=>{if(e.showSetDefault){const m={"right-icon":()=>c(Bt,{modelValue:n.isDefault,"onUpdate:modelValue":_=>n.isDefault=_,onChange:_=>a("changeDefault",_)},null)};return ae(c(pe,{center:!0,title:w("defaultAddress"),class:F("default")},m),[[ne,!l.value]])}};return W({setAreaCode:z,setAddressDetail:I}),L(()=>e.addressInfo,m=>{P(n,Ie,m),De(()=>{var _;const g=(_=s.value)==null?void 0:_.getSelectedOptions();g&&g.every(p=>p&&p.value!==U)&&V(g)})},{deep:!0,immediate:!0}),()=>{const{disableArea:m}=e;return c(st,{class:F(),onSubmit:y},{default:()=>{var _;return[c("div",{class:F("fields")},[c(J,{modelValue:n.name,"onUpdate:modelValue":g=>n.name=g,clearable:!0,label:w("name"),rules:b.value.name,placeholder:w("name"),onFocus:()=>d("name")},null),c(J,{modelValue:n.tel,"onUpdate:modelValue":g=>n.tel=g,clearable:!0,type:"tel",label:w("tel"),rules:b.value.tel,maxlength:e.telMaxlength,placeholder:w("tel"),onFocus:()=>d("tel")},null),ae(c(J,{readonly:!0,label:w("area"),"is-link":!m,modelValue:r.value,rules:b.value.areaCode,placeholder:e.areaPlaceholder||w("area"),onFocus:()=>d("areaCode"),onClick:()=>{a("clickArea"),v.value=!m}},null),[[ne,e.showArea]]),c($t,{show:e.showDetail,rows:e.detailRows,rules:b.value.addressDetail,value:n.addressDetail,focused:i.value,maxlength:e.detailMaxlength,searchResult:e.searchResult,showSearchResult:e.showSearchResult,onBlur:M,onFocus:()=>d("addressDetail"),onInput:k,onSelectSearch:g=>a("selectSearch",g)},null),(_=t.default)==null?void 0:_.call(t)]),H(),ae(c("div",{class:F("buttons")},[c(fe,{block:!0,round:!0,type:"primary",text:e.saveButtonText||w("save"),class:F("button"),loading:e.isSaving,nativeType:"submit"},null),e.showDelete&&c(fe,{block:!0,round:!0,class:F("button"),loading:e.isDeleting,text:e.deleteButtonText||w("delete"),onClick:x},null)]),[[ne,!l.value]]),c(Je,{show:v.value,"onUpdate:show":g=>v.value=g,round:!0,teleport:"body",position:"bottom",lazyRender:!1},{default:()=>[c(pt,{modelValue:n.areaCode,"onUpdate:modelValue":g=>n.areaCode=g,ref:s,loading:!f.value,areaList:e.areaList,columnsPlaceholder:e.areaColumnsPlaceholder,onConfirm:D,onCancel:()=>{v.value=!1}},null)]})]}})}}});const Ht=X(It);const Ft={components:{Header:Ve},setup(){const e=We(),a=Xe(),t=Ze(),s=xe({areaList:{province_list:{11e4:"广东省",12e4:"浙江省"},city_list:{110100:"广州市",110200:"深圳市",120100:"杭州市",120200:"宁波市"},county_list:{110101:"天河区",110102:"海珠区",120102:"上城区",130102:"下城区"}},addressInfo:{}}),n=r=>{e.query.type==="add"?(t.commit("addressOptions/addaddress",r),G("添加成功")):(t.commit("addressOptions/editaddress",r),G("编辑成功")),setTimeout(()=>{a.back()},1e3)},v=r=>{t.commit("addressOptions/deleteaddress",r),G("删除成功"),setTimeout(()=>{a.back()},1e3)},i=()=>{t.state.addressOptions.userAddress.forEach(r=>{r.id===Number(e.query.id)&&(s.addressInfo=r)})},f=T(()=>e.query.type==="add"?"地址新增":"地址编辑");return et(()=>{i()}),{...tt(s),onSave:n,onDelete:v,address:f}}};function Nt(e,a,t,s,n,v){const i=Ve,f=Ht;return at(),nt(Oe,null,[c(i,{title:s.address},null,8,["title"]),c(f,{"area-list":e.areaList,"show-delete":"","show-set-default":"","show-search-result":"","area-columns-placeholder":["请选择","请选择","请选择"],onSave:s.onSave,onDelete:s.onDelete,"address-info":e.addressInfo},null,8,["area-list","onSave","onDelete","address-info"])],64)}const Qt=Qe(Ft,[["render",Nt],["__scopeId","data-v-004db57e"]]);export{Qt as default};
